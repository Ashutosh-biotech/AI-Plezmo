{% extends 'template.html' %}

{% block title %}BLog{% endblock title %}

{% block pics_url %}{{ pic }}{% endblock pics_url %}

{% block links %}<link rel="stylesheet" href="/assets/style.css">
<script src="/assets/js/jquery-3.5.1.min.js"></script>{% endblock links %}
{% block body %}
{% load humanize %}

<main class="page blog-post">
    <section class="clean-block clean-post bg-dark">
        <div class="container">
            <div class="block-content">
                <div class="post-image" style="background-image:url(&quot;https://source.unsplash.com/1600x900/?nature,water&quot;);"></div>
                <div class="post-body bg-secondary">
                    <h3><img src="{{ post.logo }}" style="height: 5rem;">&nbsp; &nbsp;{{ post.title }}</h3>
                    <div class="post-info" style="color: #ffc107 !important;"><span>By {{ post.author }}</span><span>{{ post.timeStamp|date }}</span></div>
                    <p><pre>{{ post.content }}</pre></p>

                    <h1 class="text-dark">Comments ({{ comments.count }})</h1>
                    {% if user.is_authenticated %}
                    <form action="{% url 'postComment' %}" method="post">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="exampleInputEmail1">Post Comment </label>
                            <br>
                            <textarea type="text" class="form-control" name="comment" placeholder="Enter comment here"></textarea>
                        </div>
                        <input type="hidden" name="postSno" value="{{post.sno}}">
                        <input type="hidden" name="user" id="inputUser">
                        <br>
                        <button type="submit" class="btn btn-primary">Post</button>
                    </form>
                    {% endif %}
                    {% for comment in comments %}
                    <h4><img src="{{ comment.logo }}" style="height: 2rem;">&nbsp; &nbsp;{{ comment.user.username }} | {{ comment.timestamp|date }}</h4>
                    <p><pre style="max-height: 100px;overflow: auto;">{{ comment.comment }}</pre></p>
                        {% if user.is_authenticated %}
                            {% if comment.user.username == user.username %}
                                <form action="{% url 'delete_blogpost' %}" method="post" class="w3-right delete_blogpost{{post.sno}}" style="margin: 0px">
                                    {% csrf_token %}
                                        <input type="hidden" name="sno" value="{{comment.sno}}">
                                        <button class="btn btn-outline-danger btn-sm" type="submit" style="float: right;"><i class="far fa-trash-alt"></i>Delete</button>
                                    </form>
                                    <script>
                                $(".delete_blogpost{{post.sno}}").submit(function(e) {
                                    e.preventDefault();
                                    var form = $(this);
                                    var url = form.attr('action');
                                    var conf = window.confirm('Are you sure to delete this post?');
                                    if (conf) {
                                        $.ajax({
                                        type: "POST",
                                        url: url,
                                        data: form.serialize(), // serializes the form's elements.
                                        success: function(data)
                                        {
                                            window.location.reload() // show response from the php script.
                                        }
                                    });
                                    }

                                });
                            </script>
                        {% else %}
                                <button class="btn btn-outline-warning btn-sm" type="button" onclick="document.getElementById('{{post.sno}}').style.display='block'" style="float: right;"><i class="fas fa-exclamation-circle"></i>Report</button>
                                <div id="{{post.sno}}" class="w3-modal" style="display: none;">
                                    <div class="w3-modal-content w3-card-4 w3-black w3-animate-zoom w3-round" style="max-width:600px">

                                        <form class="w3" action="{% url 'error' %}" method="POST">
                                        {% csrf_token %}
                                            <div class="w3-section w3-container" style="padding-top: 20px;">
                                                <label><b>Your name : {{ user.username }}</b></label>
                                                <br>
                                                <label><b>Against : {{comment.user.username}}</b><br>Select a strong option:</label>
                                                <br>
                                                <label class="w3-text-red"><u>if false detail is provided than it may harm to you.</u></label>
                                                <input type="hidden" name="error_to" value="{{comment.user.username}}">
                                                <input type="hidden" name="error_from" value="{{ user.username }}">
                                                <br>
                                                <select class="w3-padding w3-btn" required name="error">
                                                    <optgroup label="be sure">
                                                        <option value="Cyber Trolling">Cyber Trolling</option>
                                                        <option value="Cyber Bulling">Cyber Bulling</option>
                                                        <option value="cyber stalking">Cyber stalking</option>
                                                        <option value="Child Pornogrphy">Child Pornogrphy</option>
                                                        <option value="Spreading Rumour" selected="">Spreading Rumour</option>
                                                        <option value="Child Abuse">Child Abuse</option>
                                                        <option value="identification error">identification error</option>
                                                        <option value="Fake account">Fake account</option>
                                                        <option value="others">others</option>
                                                    </optgroup>
                                                </select>

                                            </div>
                                            <div class="w3-container w3-border-top w3-padding-16 w3-light-grey">
                                                <button type="submit" class="btn btn-success w3-round w3-card w3-hover-green">Submit</button>
                                                <button onclick="document.getElementById('{{post.sno}}').style.display='none'" type="button" class="w3-red w3-round w3-card-4 btn btn-danger w3-hover-red">Cancel</button>
                                            </div>
                                        </form>

                                    </div>
                                </div>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </section>
</main>
{% endblock body %}